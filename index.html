<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panoramdle</title>
    <style>
        :root {
            --news-color: #3b82f6;
            --panorama-color: #f59e0b;
            --success-color: #22c55e;
            --error-color: #ef4444;
            --bg-color: #121212;
            --text-color: #ffffff;
            --disabled-color: #333333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); overflow: hidden; }
        
        /* --- –≠–∫—Ä–∞–Ω—ã --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        .hidden { display: none !important; }

        /* --- –ì–ª–∞–≤–Ω–∞—è (–°—Ç–∞—Ä—Ç) --- */
        #start-screen { background: #000; text-align: center; padding: 20px; }
        h1 { font-size: 3rem; margin-bottom: 0.5rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; }
        .subtitle { color: #888; margin-bottom: 2rem; font-size: 1.2rem; }
        
        .btn-start {
            padding: 15px 40px; font-size: 1.5rem; background: #fff; color: #000; border: none;
            text-transform: uppercase; font-weight: bold; transition: transform 0.2s;
            border-radius: 5px; cursor: pointer;
        }
        .btn-start:hover:not(:disabled) { transform: scale(1.05); }
        .btn-start:disabled { background-color: var(--disabled-color); color: #888; cursor: not-allowed; }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–æ–∫ - —Ç–µ–ø–µ—Ä—å –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω—ã–π */
        .status-text { margin-top: 15px; color: #666; font-size: 0.9rem; max-width: 600px; line-height: 1.4; }
        
        .timer-msg { 
            margin-top: 20px; color: #aaa; font-size: 1rem; line-height: 1.5;
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;
            border: 1px dashed #444; max-width: 400px;
        }

        /* --- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ --- */
        #game-screen { display: flex; flex-direction: column; }
        .progress-container {
            position: absolute; top: 20px; left: 0; width: 100%;
            display: flex; justify-content: center; gap: 10px; z-index: 50;
        }
        .dot { width: 12px; height: 12px; border-radius: 50%; background: rgba(255,255,255,0.3); transition: all 0.3s; }
        .dot.correct { background: var(--success-color); box-shadow: 0 0 10px var(--success-color); }
        .dot.wrong { background: var(--error-color); box-shadow: 0 0 10px var(--error-color); }
        .dot.active { background: #fff; transform: scale(1.3); }

        .news-display {
            position: relative; height: 35vh; width: 100%;
            background-size: cover; background-position: center;
            display: flex; align-items: flex-end; 
        }
        .news-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0.6) 40%, rgba(0,0,0,0) 100%);
            z-index: 1;
        }
        .news-text {
            position: relative; z-index: 2; padding: 20px; width: 100%;
            text-align: center; font-size: 1.4rem; font-weight: 600; text-shadow: 0 2px 4px #000;
            margin-bottom: 10px;
        }
        .region-badge {
            position: absolute; top: 20px; right: 20px; z-index: 5;
            background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 4px;
            font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px;
            backdrop-filter: blur(5px);
        }

        .controls-area { height: 65vh; width: 100%; display: flex; }
        .choice-btn {
            width: 50%; height: 100%; border: none; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; font-weight: 900; text-transform: uppercase;
            transition: all 0.3s ease; color: rgba(255,255,255,0.7);
        }
        .btn-left { background-color: #1a1a1a; border-right: 1px solid #333; }
        .btn-right { background-color: #1a1a1a; }
        
        .btn-left:hover { background-color: var(--news-color); color: #fff; flex-grow: 1.1; }
        .btn-right:hover { background-color: var(--panorama-color); color: #fff; flex-grow: 1.1; }

        #result-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; text-align: center; padding: 20px;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #result-overlay.show { opacity: 1; pointer-events: auto; }
        #result-overlay.correct-bg { background-color: rgba(34, 197, 94, 0.95); }
        #result-overlay.wrong-bg { background-color: rgba(239, 68, 68, 0.95); }
        
        .res-tag { font-size: 4rem; font-weight: 900; margin-bottom: 20px; text-transform: uppercase; }
        .res-explanation { font-size: 1.5rem; margin-bottom: 30px; max-width: 600px; line-height: 1.4; }
        
        .source-link {
            display: inline-flex; align-items: center; margin-top: 15px; padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px; color: #fff; text-decoration: none;
            font-size: 1rem; font-weight: 600; transition: all 0.2s;
        }
        .source-link:hover { background-color: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        
        .btn-next {
            margin-top: 30px; padding: 15px 50px; font-size: 1.2rem; background: #fff; color: #000;
            border: none; border-radius: 50px; cursor: pointer; font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        #final-screen { background: #111; text-align: center; }
        .final-score { font-size: 6rem; font-weight: bold; color: var(--success-color); }
        .final-rank { font-size: 2rem; color: #aaa; margin-bottom: 30px; }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω 1: –°—Ç–∞—Ä—Ç -->
    <div id="start-screen" class="screen">
        <h1>Panoramdle</h1>
        <div class="subtitle">Daily Reality Check</div>
        <button class="btn-start" onclick="startGame()" id="start-btn" disabled>–ó–∞–≥—Ä—É–∑–∫–∞...</button>
        <p class="status-text" id="status-text">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –Ω–æ–≤–æ—Å—Ç–µ–π...</p>
        <div class="timer-msg hidden" id="come-back-msg"></div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 2: –ò–≥—Ä–∞ -->
    <div id="game-screen" class="screen hidden">
        <div class="progress-container" id="progress-bar"></div>
        <div class="news-display" id="news-img">
            <div class="news-overlay"></div>
            <div class="region-badge" id="region-badge">RU</div>
            <div class="news-text" id="news-headline">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        <div class="controls-area">
            <button class="choice-btn btn-left" onclick="checkAnswer('REAL')">–ù–û–í–û–°–¢–¨</button>
            <button class="choice-btn btn-right" onclick="checkAnswer('FAKE')">–ü–ê–ù–û–†–ê–ú–ê</button>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –æ—Ç–≤–µ—Ç–∞ -->
    <div id="result-overlay">
        <div class="res-tag" id="res-tag">–ù–û–í–û–°–¢–¨</div>
        <div class="res-explanation" id="res-desc">–û–ø–∏—Å–∞–Ω–∏–µ...</div>
        <button class="btn-next" onclick="nextQuestion()">–î–ê–õ–ï–ï</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 3: –§–∏–Ω–∞–ª -->
    <div id="final-screen" class="screen hidden">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–Ω—è</h2>
        <div class="final-score" id="final-score">0/10</div>
        <div class="final-rank" id="final-rank">–ó–≤–∞–Ω–∏–µ</div>
        <button class="btn-start" onclick="location.reload()" style="margin-top: 20px;">–í –ú–ï–ù–Æ</button>
    </div>

    <script>
        let fullDb = [];
        let dailySet = [];
        let currentQ = 0;
        let score = 0;
        
        const todayStr = new Date().toISOString().slice(0, 10);

        // --- SEEDED RANDOM ---
        function mulberry32(a) {
            return function() {
                var t = a += 0x6D2B79F5;
                // –ò–°–ü–†–ê–í–õ–ï–ù–û: Math.imult -> Math.imul
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }
        
        function getDateSeed(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash |= 0;
            }
            return Math.abs(hash);
        }

        const seed = getDateSeed(todayStr);
        const random = mulberry32(seed); 

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- –ó–ê–ì–†–£–ó–ö–ê ---
        window.addEventListener('DOMContentLoaded', async () => {
            const startBtn = document.getElementById('start-btn');
            const statusText = document.getElementById('status-text');
            const comeBackMsg = document.getElementById('come-back-msg');

            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ LocalStorage
            const lastPlayed = localStorage.getItem('lastPlayedDate');
            if (lastPlayed === todayStr) {
                comeBackMsg.innerHTML = "–í—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ Daily Panoramdle —Å–µ–≥–æ–¥–Ω—è.<br>–ù–æ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–ª—É—á—à–∏—Ç—å —Å—á–µ—Ç –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–∫—É—á–Ω–æ ‚Äî <strong>–ø–æ–≥–Ω–∞–ª–∏ –µ—â—ë —Ä–∞–∑!</strong>";
                comeBackMsg.classList.remove('hidden');
                startBtn.innerText = "–°–´–ì–†–ê–¢–¨ –ï–©–Å –†–ê–ó";
            }

            // 2. –†–µ–∑–µ—Ä–≤–Ω–∞—è –±–∞–∑–∞ (–Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏)
            const fallbackDb = [
                { id: 1, type: "REAL", region: "ru", text: "–í –ì–æ—Å–¥—É–º–µ –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏ –Ω–∞–ª–æ–≥ –Ω–∞ –±–µ–∑–¥–µ—Ç–Ω–æ—Å—Ç—å.", desc: "–¢–∞–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∑–≤—É—á–∞–ª–æ –æ—Ç –¥–µ–ø—É—Ç–∞—Ç–æ–≤.", img: "https://placehold.co/800x600/111/FFF?text=News+1", link: "" },
                { id: 2, type: "FAKE", region: "ru", text: "–†–æ—Å–∫–æ—Å–º–æ—Å –ø–æ–∫—Ä–∞—Å–∏—Ç —Ä–∞–∫–µ—Ç—ã –ø–æ–¥ —Ö–æ—Ö–ª–æ–º—É.", desc: "–≠—Ç–æ —Å–∞—Ç–∏—Ä–∞.", img: "https://placehold.co/800x600/222/FFF?text=News+2", link: "" },
                { id: 3, type: "REAL", region: "usa", text: "–ò–ª–æ–Ω –ú–∞—Å–∫ –≤—ã–∑–≤–∞–ª –ü—É—Ç–∏–Ω–∞ –Ω–∞ –ø–æ–µ–¥–∏–Ω–æ–∫ –≤ Twitter.", desc: "–≠—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –±—ã–ª–æ –≤ 2022 –≥–æ–¥—É.", img: "https://placehold.co/800x600/333/FFF?text=News+3", link: "" },
                { id: 4, type: "FAKE", region: "world", text: "–û–û–ù –∑–∞–ø—Ä–µ—Ç–∏–ª–∞ –±—É–∫–≤—É Z –≤ –∞–ª—Ñ–∞–≤–∏—Ç–µ.", desc: "–í—ã–¥—É–º–∫–∞.", img: "https://placehold.co/800x600/444/FFF?text=News+4", link: "" },
                { id: 5, type: "REAL", region: "world", text: "–ê–≤—Å—Ç—Ä–∞–ª–∏—è –ø—Ä–æ–∏–≥—Ä–∞–ª–∞ –≤–æ–π–Ω—É —Å—Ç—Ä–∞—É—Å–∞–º —ç–º—É.", desc: "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç 1932 –≥–æ–¥–∞.", img: "https://placehold.co/800x600/555/FFF?text=News+5", link: "" },
                { id: 6, type: "FAKE", region: "ru", text: "–°–±–µ—Ä–±–∞–Ω–∫ –≤–≤–µ–ª –∫–æ–º–∏—Å—Å–∏—é –∑–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ –≥–ª–∞–∑–∞–º–∏.", desc: "–®—É—Ç–∫–∞ –æ –∫–æ–º–∏—Å—Å–∏—è—Ö –±–∞–Ω–∫–æ–≤.", img: "https://placehold.co/800x600/666/FFF?text=News+6", link: "" },
                { id: 7, type: "REAL", region: "usa", text: "–ö–æ—Ç —Å—Ç–∞–ª –º—ç—Ä–æ–º –≥–æ—Ä–æ–¥–∞ –Ω–∞ –ê–ª—è—Å–∫–µ.", desc: "–ö–æ—Ç –°—Ç–∞–±–±—Å –ø—Ä–∞–≤–∏–ª —Å 1997 –ø–æ 2017.", img: "https://placehold.co/800x600/777/FFF?text=News+7", link: "" },
                { id: 8, type: "FAKE", region: "world", text: "Apple –≤—ã–ø—É—Å—Ç–∏–ª–∞ –∫–∏—Ä–ø–∏—á iBrick –∑–∞ $1000.", desc: "–°–∞—Ç–∏—Ä–∞ –Ω–∞ —Ü–µ–Ω—ã –∫–æ–º–ø–∞–Ω–∏–∏.", img: "https://placehold.co/800x600/888/FFF?text=News+8", link: "" },
                { id: 9, type: "REAL", region: "eu", text: "–í –§–∏–Ω–ª—è–Ω–¥–∏–∏ –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –ø–æ –ø–µ—Ä–µ–Ω–æ—Å–∫–µ –∂–µ–Ω.", desc: "–ï–∂–µ–≥–æ–¥–Ω—ã–π —á–µ–º–ø–∏–æ–Ω–∞—Ç –º–∏—Ä–∞.", img: "https://placehold.co/800x600/999/FFF?text=News+9", link: "" },
                { id: 10, type: "FAKE", region: "eu", text: "–ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–µ —É—á–µ–Ω—ã–µ –¥–æ–∫–∞–∑–∞–ª–∏, —á—Ç–æ –∫–æ—Ç—ã ‚Äî –∂–∏–¥–∫–∏–µ.", desc: "–≠—Ç–æ —Å—Ç–∞—Ä—ã–π –º–µ–º, –∞ –Ω–µ –Ω–∞—É–∫–∞.", img: "https://placehold.co/800x600/aaa/FFF?text=News+10", link: "" },
                { id: 11, type: "REAL", region: "ru", text: "–ú—É–∂—á–∏–Ω–∞ –ø–æ–¥–∞–ª –≤ —Å—É–¥ –Ω–∞ —Å–∞–º–æ–≥–æ —Å–µ–±—è –∏ –≤—ã–∏–≥—Ä–∞–ª.", desc: "–†–µ–∞–ª—å–Ω–æ–µ –¥–µ–ª–æ –ö–µ—Ä—Ç–∏—Å–∞ –ì–æ–∫–∏.", img: "https://placehold.co/800x600/bbb/FFF?text=News+11", link: "" },
                { id: 12, type: "FAKE", region: "ru", text: "–ú–∏–Ω–∑–¥—Ä–∞–≤ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª –ª–µ—á–∏—Ç—å –¥–µ–ø—Ä–µ—Å—Å–∏—é '–°–≤–∞—Ç–∞–º–∏'.", desc: "–ß–∏—Å—Ç–∞—è —Å–∞—Ç–∏—Ä–∞.", img: "https://placehold.co/800x600/ccc/FFF?text=News+12", link: "" }
            ];

            // 3. –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å news.json
            try {
                statusText.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...";
                
                const response = await fetch('news.json');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}. –§–∞–π–ª news.json –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏ "${window.location.href.replace('index.html', '')}news.json". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ.`);
                }

                const contentType = response.headers.get("content-type");
                const responseText = await response.text(); 

                if (responseText.trim().startsWith('<')) {
                    throw new Error(`–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª HTML –≤–º–µ—Å—Ç–æ JSON. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n1. –§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ file:// (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)\n2. GitHub Pages –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ Settings ‚Üí Pages\n3. –§–∞–π–ª –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ "news.json" –∏–ª–∏ –ª–µ–∂–∏—Ç –Ω–µ –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.\n\nüîß –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Live Server –≤ VS Code –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ GitHub.`);
                }

                try {
                    fullDb = JSON.parse(responseText);
                } catch (jsonError) {
                    throw new Error(`–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ news.json –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ ${jsonError.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –Ω–∞ —Å–∞–π—Ç–µ jsonlint.com`);
                }
                
                if (!Array.isArray(fullDb) || fullDb.length === 0) {
                    throw new Error("news.json –ø—É—Å—Ç –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ []");
                }

                statusText.innerHTML = `‚úÖ –ë–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ (${fullDb.length} –Ω–æ–≤–æ—Å—Ç–µ–π)`;
                statusText.style.color = "#22c55e";

            } catch (error) {
                console.error("‚ùå –û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò:", error);
                
                fullDb = fallbackDb;
                statusText.innerHTML = `‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å news.json. –ó–∞–ø—É—â–µ–Ω –¥–µ–º–æ-—Ä–µ–∂–∏–º —Å ${fallbackDb.length} —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏.<br><br><small style="color:#ef4444">${error.message}</small>`;
                statusText.style.color = "#f59e0b";
            }

            // 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
            generateDailySet();
            
            if (lastPlayed !== todayStr) {
                startBtn.innerText = "–ù–ê–ß–ê–¢–¨";
            }
            startBtn.disabled = false;
        });

        // --- –ì–ï–ù–ï–†–ê–¶–ò–Ø ---
        function generateDailySet() {
            const realNews = fullDb.filter(item => item.type === 'REAL');
            const fakeNews = fullDb.filter(item => item.type === 'FAKE');

            if (realNews.length < 6 || fakeNews.length < 6) {
                console.warn("–í –±–∞–∑–µ –º–∞–ª–æ –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞.");
            }

            shuffleArray(realNews);
            shuffleArray(fakeNews);

            const realCount = 4 + Math.floor(random() * 3);
            const fakeCount = 10 - realCount;

            const safeRealCount = Math.min(realCount, realNews.length);
            const safeFakeCount = Math.min(fakeCount, fakeNews.length);

            const selectedReal = realNews.slice(0, safeRealCount);
            const selectedFake = fakeNews.slice(0, safeFakeCount);

            dailySet = [...selectedReal, ...selectedFake];
            shuffleArray(dailySet);
        }

        // --- –ò–ì–†–ê ---
        function startGame() {
            if(dailySet.length === 0) return alert("–û—à–∏–±–∫–∞: –í–æ–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            initDots();
            loadQuestion();
        }

        function initDots() {
            const container = document.getElementById('progress-bar');
            container.innerHTML = '';
            for(let i=0; i<dailySet.length; i++) {
                let d = document.createElement('div');
                d.className = 'dot';
                d.id = 'dot-'+i;
                container.appendChild(d);
            }
        }

        function loadQuestion() {
            if (currentQ >= dailySet.length) return showResults();
            
            const q = dailySet[currentQ];
            document.getElementById('news-headline').innerText = q.text;
            document.getElementById('news-img').style.backgroundImage = `url('${q.img}')`;
            
            const region = q.region ? q.region.toUpperCase() : "WORLD";
            document.getElementById('region-badge').innerText = region;
            
            document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));
            if(document.getElementById('dot-'+currentQ)) {
                document.getElementById('dot-'+currentQ).classList.add('active');
            }
        }

        function checkAnswer(userChoice) {
            const q = dailySet[currentQ];
            const isCorrect = userChoice === q.type;
            const overlay = document.getElementById('result-overlay');
            const tag = document.getElementById('res-tag');
            const desc = document.getElementById('res-desc');
            const dot = document.getElementById('dot-'+currentQ);

            overlay.className = ''; 
            if (isCorrect) {
                overlay.classList.add('show', 'correct-bg');
                tag.innerText = "–í–ï–†–ù–û!";
                score++;
                if(dot) dot.classList.add('correct');
            } else {
                overlay.classList.add('show', 'wrong-bg');
                tag.innerText = "–û–®–ò–ë–ö–ê!";
                if(dot) dot.classList.add('wrong');
            }
            
            let content = `<strong>–≠–¢–û ${q.type === 'REAL' ? '–ù–û–í–û–°–¢–¨' : '–ü–ê–ù–û–†–ê–ú–ê'}</strong><br>${q.desc}`;
            
            if (q.link && q.link.length > 5) {
                content += `<br><a href="${q.link}" target="_blank" class="source-link">üîó –ò—Å—Ç–æ—á–Ω–∏–∫</a>`;
            }
            
            desc.innerHTML = content;
        }

        function nextQuestion() {
            document.getElementById('result-overlay').classList.remove('show');
            currentQ++;
            loadQuestion();
        }

        function showResults() {
            localStorage.setItem('lastPlayedDate', todayStr);

            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('final-screen').classList.remove('hidden');
            
            document.getElementById('final-score').innerText = `${score} / ${dailySet.length}`;
            
            const percent = score / dailySet.length;
            let rank = "–ù–æ–≤–∏—á–æ–∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞";
            if(percent > 0.4) rank = "–û–ø—ã—Ç–Ω—ã–π —Å–µ—Ä—Ñ–µ—Ä";
            if(percent > 0.7) rank = "–ì—Ä–∞–Ω–¥–º–∞—Å—Ç–µ—Ä –ø–æ—Å—Ç–∏—Ä–æ–Ω–∏–∏";
            if(percent === 1) rank = "–ë–æ–≥ –Ω–æ–≤–æ—Å—Ç–Ω–æ–π –ª–µ–Ω—Ç—ã";
            
            document.getElementById('final-rank').innerText = rank;
        }
    </script>
</body>
</html>
