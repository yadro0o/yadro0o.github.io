<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panoramdle - –†–µ–∞–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –ü–∞–Ω–æ—Ä–∞–º–∞?</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --accent-color: #3b82f6;
            --success-color: #22c55e;
            --error-color: #ef4444;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* --- UI UTILS --- */
        .hidden { display: none !important; }
        .btn {
            background-color: var(--accent-color);
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }

        /* --- SCREENS --- */
        .screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
        }

        /* START SCREEN */
        .logo { font-size: 3rem; font-weight: 800; margin-bottom: 10px; color: var(--text-color); }
        .subtitle { color: #64748b; margin-bottom: 40px; max-width: 400px; line-height: 1.5; }
        .status-text { margin-top: 20px; font-size: 0.9rem; color: #94a3b8; }
        .come-back-msg { 
            margin-bottom: 20px; 
            padding: 10px; 
            background: #e0f2fe; 
            color: #0369a1; 
            border-radius: 8px; 
            font-size: 0.9rem;
        }

        /* ADMIN PANEL */
        .admin-panel {
            margin-top: 30px;
            padding: 10px;
            border: 1px dashed #cbd5e1;
            border-radius: 8px;
            background: #f1f5f9;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        .admin-toggle {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 0.8rem;
            cursor: pointer;
            text-decoration: underline;
        }
        .date-picker-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        input[type="date"] {
            padding: 5px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
        }

        /* GAME SCREEN */
        #game-screen { justify-content: flex-start; padding: 0; }
        
        /* Top Section: Image + Text */
        .card-container {
            width: 100%;
            height: 40%;
            position: relative;
            background-color: #000;
            overflow: hidden;
            display: flex;
            align-items: flex-end;
        }
        .news-img {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0.6;
            transition: opacity 0.3s;
        }
        .news-content {
            position: relative;
            z-index: 2;
            padding: 20px;
            width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            color: white;
            text-align: left;
        }
        .region-badge {
            display: inline-block;
            background: var(--accent-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .headline {
            font-size: 1.3rem;
            font-weight: 700;
            line-height: 1.4;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* Bottom Section: Buttons */
        .controls-container {
            height: 60%;
            width: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 15px;
            box-sizing: border-box;
            background: white;
        }
        
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 10px;
        }
        .dot {
            width: 8px; height: 8px;
            background-color: #e2e8f0;
            border-radius: 50%;
        }
        .dot.active { background-color: var(--accent-color); transform: scale(1.2); }
        .dot.correct { background-color: var(--success-color); }
        .dot.wrong { background-color: var(--error-color); }

        .choice-btn {
            flex: 1;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 16px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
        }
        .choice-btn:hover { background: #f8fafc; border-color: #cbd5e1; }
        
        .btn-real { border-color: #bfdbfe; color: #1e40af; } 
        .btn-fake { border-color: #fecaca; color: #991b1b; }

        /* OVERLAY RESULT */
        .result-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            padding: 30px;
            box-sizing: border-box;
        }
        .result-overlay.show { opacity: 1; pointer-events: auto; }
        
        .result-overlay.correct-bg { background: rgba(220, 252, 231, 0.98); }
        .result-overlay.wrong-bg { background: rgba(254, 226, 226, 0.98); }

        .res-icon { font-size: 4rem; margin-bottom: 10px; }
        .res-tag { font-size: 2rem; font-weight: 800; margin-bottom: 20px; }
        .res-desc { font-size: 1.1rem; margin-bottom: 30px; line-height: 1.6; color: #334155; }
        .source-link { color: var(--accent-color); text-decoration: underline; display: block; margin-top: 10px;}

        /* FINAL SCREEN */
        .score-big { font-size: 4rem; font-weight: 900; color: var(--accent-color); margin: 0; }
        .rank-badge { 
            background: #f1f5f9; padding: 5px 15px; 
            border-radius: 20px; color: #64748b; margin-bottom: 30px; 
        }

    </style>
</head>
<body>

    <!-- START SCREEN -->
    <div id="start-screen" class="screen">
        <div class="logo">Panoramdle</div>
        <div class="subtitle">–û—Ç–ª–∏—á–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—É—é –Ω–æ–≤–æ—Å—Ç—å –æ—Ç —Å–∞—Ç–∏—Ä–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –ò–ê –ü–∞–Ω–æ—Ä–∞–º–∞.</div>
        
        <div id="come-back-msg" class="come-back-msg hidden"></div>
        
        <button id="start-btn" class="btn" disabled>–ó–∞–≥—Ä—É–∑–∫–∞...</button>
        <div id="status-text" class="status-text">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –Ω–æ–≤–æ—Å—Ç–µ–π...</div>

        <!-- ADMIN PANEL (Visible for testing) -->
        <div class="admin-panel">
            <button class="admin-toggle" onclick="toggleAdmin()">üõ† Debug Date (Admin)</button>
            <div id="date-controls" class="date-picker-container hidden">
                <input type="date" id="debug-date-picker">
                <button onclick="applyDebugDate()" style="padding: 5px;">Apply</button>
            </div>
        </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen hidden">
        <div class="card-container">
            <div id="news-img" class="news-img"></div>
            <div class="news-content">
                <span id="region-badge" class="region-badge">WORLD</span>
                <div id="news-headline" class="headline">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞...</div>
            </div>
        </div>

        <div class="controls-container">
            <div id="progress-bar" class="progress-bar"></div>
            <button class="choice-btn btn-real" onclick="checkAnswer('REAL')">–†–ï–ê–õ–¨–ù–û–°–¢–¨</button>
            <button class="choice-btn btn-fake" onclick="checkAnswer('FAKE')">–ò–ê –ü–ê–ù–û–†–ê–ú–ê</button>
        </div>

        <!-- RESULT OVERLAY -->
        <div id="result-overlay" class="result-overlay">
            <div id="res-icon" class="res-icon"></div>
            <div id="res-tag" class="res-tag"></div>
            <div id="res-desc" class="res-desc"></div>
            <button class="btn" onclick="nextQuestion()">–î–∞–ª–µ–µ</button>
        </div>
    </div>

    <!-- FINAL SCREEN -->
    <div id="final-screen" class="screen hidden">
        <div class="subtitle">–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ <span id="final-date-display"></span></div>
        <div class="score-big"><span id="final-score">0</span>/10</div>
        <div class="rank-badge" id="final-rank">–ß–∏—Ç–∞—Ç–µ–ª—å</div>
        <p>–í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞–≤—Ç—Ä–∞ –∑–∞ –Ω–æ–≤–æ–π –ø–æ—Ä—Ü–∏–µ–π –Ω–æ–≤–æ—Å—Ç–µ–π!</p>
        <button class="btn" onclick="location.reload()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
    </div>

    <script>
        // --- STATE ---
        let fullDb = [];
        let dailySet = [];
        let currentQ = 0;
        let score = 0;
        
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ—Ä–µ–º —Å–µ–≥–æ–¥–Ω—è
        let currentDateObj = new Date();
        let todayStr = currentDateObj.toISOString().slice(0, 10);

        // --- SEEDED RANDOM (PRNG) ---
        // –ê–ª–≥–æ—Ä–∏—Ç–º Mulberry32 –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ —Ä–∞–Ω–¥–æ–º–∞ –ø–æ —Å–∏–¥—É
        function mulberry32(a) {
            return function() {
                var t = a += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }

        // –•–µ—à–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã –≤ —á–∏—Å–ª–æ
        function getDateSeed(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash |= 0;
            }
            return Math.abs(hash);
        }

        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞—à–µ–≥–æ PRNG
        function shuffleArray(array, randomFn) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(randomFn() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- CORE LOGIC ---

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–±–æ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ todayStr
        function generateDailySet() {
            if (!fullDb || fullDb.length === 0) return;

            const seed = getDateSeed(todayStr);
            const random = mulberry32(seed); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å —Å–∏–¥–æ–º –¥–∞—Ç—ã

            // 1. –°–Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä—É–µ–º –±–∞–∑—É, —á—Ç–æ–±—ã –Ω–µ –º—É—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª
            // 2. –í–∞–∂–Ω–æ: –°–æ—Ä—Ç–∏—Ä—É–µ–º –±–∞–∑—É –ø–µ—Ä–µ–¥ —à–∞—Ñ—Ñ–ª–æ–º, —á—Ç–æ–±—ã –∏—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤ JSON –Ω–µ –≤–ª–∏—è–ª 
            //    –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ JSON –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏–Ω–∞—á–µ (—Ö–æ—Ç—è –º–∞—Å—Å–∏–≤ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω).
            let pool = [...fullDb].sort((a,b) => a.id - b.id);

            // 3. –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –í–ï–°–¨ –ø—É–ª –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ
            // –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ –º—ã –±–µ—Ä–µ–º –Ω–æ–≤–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤, 
            // —Å–∞–º "—Ä–∞–Ω–¥–æ–º" –≤—ã–±–æ—Ä–∞ –±—É–¥–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥–∞—Ç–µ.
            shuffleArray(pool, random);

            // 4. –§–∏–ª—å—Ç—Ä—É–µ–º –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–π –ø—É–ª
            const realNews = pool.filter(item => item.type === 'REAL');
            const fakeNews = pool.filter(item => item.type === 'FAKE');

            // 5. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–ª–∞–Ω—Å (–æ—Ç 4 –¥–æ 6 —Ä–µ–∞–ª—å–Ω—ã—Ö)
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ random
            const realCountTarget = 4 + Math.floor(random() * 3);
            const fakeCountTarget = 10 - realCountTarget;

            // 6. –ù–∞–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —É—á–∏—Ç—ã–≤–∞—è —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –º–∞—Å—Å–∏–≤–æ–≤
            const safeRealCount = Math.min(realCountTarget, realNews.length);
            // –ï—Å–ª–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ, –ø—ã—Ç–∞–µ–º—Å—è –¥–æ–±—Ä–∞—Ç—å —Ñ–µ–π–∫–∞–º–∏ –¥–æ 10, –Ω–æ –Ω–µ –±–æ–ª—å—à–µ —á–µ–º –µ—Å—Ç—å
            const neededFakes = 10 - safeRealCount;
            const safeFakeCount = Math.min(neededFakes, fakeNews.length);

            const selectedReal = realNews.slice(0, safeRealCount);
            const selectedFake = fakeNews.slice(0, safeFakeCount);

            // 7. –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏ –°–ù–û–í–ê –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º, —á—Ç–æ–±—ã –ø–æ—Ä—è–¥–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ (REAL/FAKE) —Ç–æ–∂–µ –±—ã–ª —Å–ª—É—á–∞–π–Ω—ã–º
            let finalSet = [...selectedReal, ...selectedFake];
            shuffleArray(finalSet, random);

            dailySet = finalSet;
            
            console.log(`[Panoramdle] Date: ${todayStr}, Seed: ${seed}, Questions: ${dailySet.length}`);
            console.log(dailySet.map(q => q.type));
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞: –∏–≥—Ä–∞–ª –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        function checkHistory() {
            const lastPlayed = localStorage.getItem('lastPlayedDate');
            const startBtn = document.getElementById('start-btn');
            const comeBackMsg = document.getElementById('come-back-msg');

            if (lastPlayed === todayStr) {
                comeBackMsg.innerHTML = `–í—ã —É–∂–µ –∏–≥—Ä–∞–ª–∏ –∑–∞ –¥–∞—Ç—É <strong>${todayStr}</strong>.<br>–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∏–≥—Ä–∞—Ç—å.`;
                comeBackMsg.classList.remove('hidden');
                startBtn.innerText = "–°—ã–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑";
            } else {
                comeBackMsg.classList.add('hidden');
                startBtn.innerText = "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É";
            }
        }

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', async () => {
            const startBtn = document.getElementById('start-btn');
            const statusText = document.getElementById('status-text');

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ –ø–∏–∫–µ—Ä –∞–¥–º–∏–Ω–∫–∏
            document.getElementById('debug-date-picker').value = todayStr;

            // Fallback DB –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–æ–∫
            const fallbackDb = [
                {id: 1, type: "REAL", region: "ru", text: "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å 1 (REAL)", desc: "–û–ø–∏—Å–∞–Ω–∏–µ...", img: "https://placehold.co/800x600/111/FFF?text=News1", link: ""},
                {id: 2, type: "FAKE", region: "ru", text: "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å 2 (FAKE)", desc: "–û–ø–∏—Å–∞–Ω–∏–µ...", img: "https://placehold.co/800x600/222/FFF?text=News2", link: ""},
                {id: 3, type: "REAL", region: "usa", text: "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å 3 (REAL)", desc: "–û–ø–∏—Å–∞–Ω–∏–µ...", img: "https://placehold.co/800x600/333/FFF?text=News3", link: ""},
                {id: 4, type: "FAKE", region: "world", text: "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å 4 (FAKE)", desc: "–û–ø–∏—Å–∞–Ω–∏–µ...", img: "https://placehold.co/800x600/444/FFF?text=News4", link: ""}
            ];

            try {
                const response = await fetch('news.json');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const responseText = await response.text();
                // –ü—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞, –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã 404
                if (responseText.trim().startsWith('<')) throw new Error('Not JSON (HTML received)');
                
                fullDb = JSON.parse(responseText);
                statusText.innerHTML = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${fullDb.length}.`;
                statusText.style.color = "#22c55e"; // green

            } catch (e) {
                console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ news.json, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤:", e);
                fullDb = fallbackDb;
                statusText.innerHTML = `–û—à–∏–±–∫–∞ news.json (${e.message}). –í–∫–ª—é—á–µ–Ω —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º.`;
                statusText.style.color = "#f59e0b"; // amber
            } finally {
                // –í–ê–ñ–ù–û: –í—ã–∑—ã–≤–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∑–¥–µ—Å—å, –∫–æ–≥–¥–∞ –±–∞–∑–∞ —Ç–æ—á–Ω–æ –≥–æ—Ç–æ–≤–∞
                generateDailySet();
                checkHistory();
                startBtn.disabled = false;
            }
        });

        // --- GAME LOGIC ---

        function startGame() {
            if (!dailySet || dailySet.length === 0) {
                alert("–û—à–∏–±–∫–∞: –≤–æ–ø—Ä–æ—Å—ã –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
                return;
            }
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            initDots();
            loadQuestion();
        }

        function initDots() {
            const container = document.getElementById('progress-bar');
            container.innerHTML = '';
            for(let i=0; i<dailySet.length; i++) {
                let d = document.createElement('div');
                d.className = 'dot';
                d.id = `dot-${i}`;
                container.appendChild(d);
            }
        }

        function loadQuestion() {
            if (currentQ >= dailySet.length) {
                showResults();
                return;
            }
            const q = dailySet[currentQ];
            document.getElementById('news-headline').innerText = q.text;
            
            // Image handling
            const imgEl = document.getElementById('news-img');
            imgEl.style.backgroundImage = `url('${q.img}')`;
            
            const region = q.region ? q.region.toUpperCase() : "WORLD";
            document.getElementById('region-badge').innerText = region;

            // Update dots
            document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));
            const curDot = document.getElementById(`dot-${currentQ}`);
            if(curDot) curDot.classList.add('active');
        }

        function checkAnswer(userChoice) {
            const q = dailySet[currentQ];
            const isCorrect = (userChoice === q.type);
            
            const overlay = document.getElementById('result-overlay');
            const icon = document.getElementById('res-icon');
            const tag = document.getElementById('res-tag');
            const desc = document.getElementById('res-desc');
            const dot = document.getElementById(`dot-${currentQ}`);

            // Reset classes
            overlay.className = 'result-overlay show'; 

            if (isCorrect) {
                score++;
                overlay.classList.add('correct-bg');
                icon.innerText = "‚úÖ";
                tag.innerText = "–í–ï–†–ù–û!";
                tag.style.color = "#15803d"; // dark green
                if(dot) dot.classList.add('correct');
            } else {
                overlay.classList.add('wrong-bg');
                icon.innerText = "‚ùå";
                tag.innerText = "–û–®–ò–ë–ö–ê";
                tag.style.color = "#b91c1c"; // dark red
                if(dot) dot.classList.add('wrong');
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
            let typeLabel = (q.type === 'REAL') ? "–≠—Ç–æ —Ä–µ–∞–ª—å–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å." : "–≠—Ç–æ —Å–∞—Ç–∏—Ä–∞ –ò–ê –ü–∞–Ω–æ—Ä–∞–º–∞.";
            let content = `<strong>${typeLabel}</strong><br>${q.desc || ''}`;
            
            if (q.link && q.link.length > 5) {
                content += `<br><a href="${q.link}" target="_blank" class="source-link">–ò—Å—Ç–æ—á–Ω–∏–∫ / –ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>`;
            }
            desc.innerHTML = content;
        }

        function nextQuestion() {
            document.getElementById('result-overlay').classList.remove('show');
            currentQ++;
            loadQuestion();
        }

        function showResults() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–∫—Ç –∏–≥—Ä—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –±—ã–ª "—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π" –¥–µ–Ω—å (–¥–ª—è —á–µ—Å—Ç–Ω–æ—Å—Ç–∏)
            // –ù–æ –≤ —Ä–µ–∂–∏–º–µ –¥–µ–±–∞–≥–∞ —ç—Ç–æ –Ω–µ —Ç–∞–∫ –≤–∞–∂–Ω–æ. –°–æ—Ö—Ä–∞–Ω–∏–º —Ç–µ–∫—É—â–∏–π todayStr.
            localStorage.setItem('lastPlayedDate', todayStr);

            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('final-screen').classList.remove('hidden');
            
            document.getElementById('final-date-display').innerText = todayStr;
            document.getElementById('final-score').innerText = score;
            
            const percent = score / dailySet.length;
            let rank = "–ß–∏—Ç–∞—Ç–µ–ª—å";
            if(percent > 0.4) rank = "–ù–æ–≤–æ—Å—Ç–Ω–æ–π —ç—Ä—É–¥–∏—Ç";
            if(percent > 0.7) rank = "–ú–∞–≥–∏—Å—Ç—Ä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏";
            if(percent === 1) rank = "–ë–æ–≥ –ü–∞–Ω–æ—Ä–∞–º—ã";

            document.getElementById('final-rank').innerText = rank;
        }

        // --- ADMIN / DEBUG FUNCTIONS ---
        function toggleAdmin() {
            const el = document.getElementById('date-controls');
            el.classList.toggle('hidden');
        }

        function applyDebugDate() {
            const picker = document.getElementById('debug-date-picker');
            if (!picker.value) return;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–∞—Ç—ã
            todayStr = picker.value;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            currentQ = 0;
            score = 0;
            
            // –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–µ—Ç —Å –ù–û–í–´–ú —Å–∏–¥–æ–º
            generateDailySet();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å—Ç–∞—Ç—É—Å–∞
            checkHistory();
            
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            const btn = document.querySelector('.admin-panel button:last-child');
            const originalText = btn.innerText;
            btn.innerText = "Applied!";
            setTimeout(() => btn.innerText = originalText, 1000);

            alert(`–î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ ${todayStr}.\n–í–æ–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.`);
        }

    </script>
</body>
</html>
